{% extends "base.html" %}

{% block title %}Dashboard â€” Racha{% endblock %}

{% block nav_right %}
<div class="flex items-center gap-4">
    <span class="text-sm" style="color: var(--text-secondary);">{{ username }}</span>
    <form method="post" action="/logout">
        <button type="submit" class="text-sm neu-link">Log out</button>
    </form>
</div>
{% endblock %}

{% block content %}
<div class="grid md:grid-cols-3 gap-6">
    <!-- Tasks column -->
    <div class="md:col-span-2 space-y-5">
        <!-- Header -->
        <div>
            <h2 class="text-2xl font-bold gradient-text">Daily Tasks</h2>
            <p class="text-sm mt-1" style="color: var(--text-secondary);">Stay consistent, build streaks</p>
        </div>

        <!-- Progress bar -->
        <div class="neu-raised p-4">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium" style="color: var(--text-secondary);">Today's Progress</span>
                <span class="text-sm font-bold gradient-text">{{ completed_count }}/{{ total_count }}</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" style="width: {% if total_count > 0 %}{{ completed_count * 100 / total_count }}{% else %}0{% endif %}%"></div>
            </div>
        </div>

        <!-- Streak summary -->
        {% if active_streak_count > 0 %}
        <div class="flex gap-4">
            <div class="neu-flat p-3 flex-1 flex items-center gap-3">
                <svg class="w-5 h-5" style="color: var(--gradient-pink);" viewBox="0 0 24 24" fill="currentColor"><path d="M12 23c-3.866 0-7-3.134-7-7 0-3 2-5 3-7 .5 2 2 3 2 3 0-4 3-8 6-10-.5 2 0 4 1 5.5S19 10 19 13c0 1-.5 2.5-1.5 4-.5-1.5-1.5-2-1.5-2 0 2-1 4-2.5 5.5-.5.5-1 1-1.5 2.5z"/></svg>
                <div>
                    <div class="text-lg font-bold" style="color: var(--text-primary);">{{ active_streak_count }}</div>
                    <div class="text-xs" style="color: var(--text-secondary);">Active Streak{{ active_streak_count|pluralize }}</div>
                </div>
            </div>
            <div class="neu-flat p-3 flex-1 flex items-center gap-3">
                <svg class="w-5 h-5" style="color: #fbbf24;" viewBox="0 0 24 24" fill="currentColor"><path d="M12 23c-3.866 0-7-3.134-7-7 0-3 2-5 3-7 .5 2 2 3 2 3 0-4 3-8 6-10-.5 2 0 4 1 5.5S19 10 19 13c0 1-.5 2.5-1.5 4-.5-1.5-1.5-2-1.5-2 0 2-1 4-2.5 5.5-.5.5-1 1-1.5 2.5z"/></svg>
                <div>
                    <div class="text-lg font-bold" style="color: var(--text-primary);">{{ longest_streak }}</div>
                    <div class="text-xs" style="color: var(--text-secondary);">Longest Streak</div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- New task button -->
        <div class="flex items-center justify-between">
            <span></span>
            <button hx-get="/tasks/form" hx-target="#task-form-slot" hx-swap="innerHTML"
                    class="btn-gradient flex items-center gap-2">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                New Task
            </button>
        </div>

        <div id="task-form-slot" class="mb-1"></div>
        <div id="task-list" class="space-y-3">
            {% for task in tasks %}
            {% include "tasks/_task_card.html" %}
            {% endfor %}
            {% if tasks.is_empty() %}
            <div class="neu-raised p-8 text-center">
                <p style="color: var(--text-secondary);">No tasks yet. Create one to start tracking!</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Groups sidebar -->
    <div>
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold gradient-text">Groups</h2>
            <div class="flex gap-2">
                <button hx-get="/groups/join-form" hx-target="#group-form-slot" hx-swap="innerHTML"
                        class="text-sm neu-link font-medium">Join</button>
                <button hx-get="/groups/create-form" hx-target="#group-form-slot" hx-swap="innerHTML"
                        class="btn-gradient text-xs px-3 py-1.5 flex items-center gap-1">
                    <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    New
                </button>
            </div>
        </div>
        <div id="group-form-slot" class="mb-4"></div>
        <div class="space-y-3">
            {% for group in groups %}
            <a href="/groups/{{ group.id }}"
               class="block neu-flat p-4 hover:scale-[1.02] transition-transform">
                <div class="font-medium" style="color: var(--text-primary);">{{ group.name }}</div>
                <div class="text-sm flex items-center gap-1.5 mt-1" style="color: var(--text-secondary);">
                    <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    {{ group.member_count }} member{{ group.member_count|pluralize }}
                </div>
            </a>
            {% endfor %}
            {% if groups.is_empty() %}
            <div class="neu-flat p-4 text-center">
                <p class="text-sm" style="color: var(--text-secondary);">No groups yet.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
